<div class="container">
  <div class="d-flex flex-wrap my-4 align-items-center">
    <div class="col-12 col-md-auto d-flex align-items-center mb-3 mb-md-0 flex-grow-1">
      <app-page-header-bar
        [pageTitle]="pageTitle"
        (addTask)="openModal()">
      </app-page-header-bar>
    </div>
    <div class="col-12 col-md-auto ms-md-auto">
      <app-search-filter-bar
        [isFilterPanelOpen]="isFilterPanelOpen"
        (searchChange)="onSearchChange($event)"
        (toggleFilter)="toggleFilterPanel()">
      </app-search-filter-bar>
    </div>
  </div>
  <div class="row">
    <div [ngClass]="isFilterPanelOpen ? 'col-md-8' : 'col-md-12'">
      <ul class="list-group">
        @for (task of filteredTasks; track task.id) {
          <app-task-item 
            [task]="task"
            [index]="$index"
            [openDropdownIndex]="openDropdownIndex"
            [closingDropdownIndex]="closingDropdownIndex"
            (toggleComplete)="toggleCompleted($event)"
            (toggleFlagEvent)="toggleFlag($event.task, $event.event)"
            (dropdownToggle)="toggleDropdown($event.index, $event.event)"
            (editTask)="openEditModal($event)"
            (deleteTask)="deleteTask($event)">
          </app-task-item>
    } @empty {
      <li class="list-group-item text-center text-muted py-4">
        Brak zadań do wyświetlenia
      </li>
    }
      </ul>
    </div>
    @if (isFilterPanelOpen) {
      <div class="col-md-4 filter-panel-slide">
        <app-filter-panel
          [filters]="filters"
          [sortByDate]="sortByDate"
          [hasActiveFilters]="hasActiveFilters"
          [defaultDateFrom]="defaultDateFrom"
          [defaultDateTo]="defaultDateTo"
          (closePanel)="toggleFilterPanel()"
          (filtersChange)="onFiltersChange($event)"
          (sortByDateChange)="onSortByDateChange($event)"
          (clearFiltersClick)="clearFilters()">
        </app-filter-panel>
      </div>
    }
  </div>
</div>

<app-task-modal
  [isOpen]="isModalOpen"
  [isEditMode]="isEditMode"
  [task]="editingTask"
  (close)="closeModal()"
  (save)="saveTask($event)">
</app-task-modal>

